window.__require=function t(e,o,n){function r(c,s){if(!o[c]){if(!e[c]){var a=c.split("/");if(a=a[a.length-1],!e[a]){var u="function"==typeof __require&&__require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+c+"'")}c=a}var h=o[c]={exports:{}};e[c][0].call(h.exports,function(t){return r(e[c][1][t]||t)},h,h.exports,t,e,o,n)}return o[c].exports}for(var i="function"==typeof __require&&__require,c=0;c<n.length;c++)r(n[c]);return r}({Config:[function(t,e,o){"use strict";cc._RF.push(e,"7d259bcpq1GepgSPh9U8W5v","Config"),Object.defineProperty(o,"__esModule",{value:!0}),o.Config=void 0,o.Config={data:[{index:0,correctAnswer:"What's your name?",questions:["your","name?","What's"]},{index:1,correctAnswer:"How old are you?",questions:["old","you?","are","How"]},{index:2,correctAnswer:"I am seven.",questions:["am","I","seven."]},{index:3,correctAnswer:"Raise your hand, please.",questions:["please.","your","Raise","hand,"]}]},cc._RF.pop()},{}],Delegate:[function(t,e,o){"use strict";cc._RF.push(e,"c986aZS7eJF9LbSvqvx3QPN","Delegate"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./Config"),r=function(){function t(t){this.root=t;var e=cc.sys.localStorage.getItem("operation");e&&(this.operation=JSON.parse(e)),this.operateLock=!1}return t.prototype.start=function(){this.addListener(),this.operation?this.resumeGameStatus():this.gameStart()},t.prototype.onDestroy=function(){this.delListener(),this.root=null},t.prototype.setOperationLock=function(){this.operateLock=!0,this.backToBase()},t.prototype.setOperationFree=function(){this.operateLock=!1},t.prototype.backToBase=function(){var t=this;if(this.curTarget&&this.curTargetBasePos){var e=this.operation.data,o=this.curTarget.getComponent(cc.Label).string;e.forEach(function(e){e.content==o&&(e.position=t.curTargetBasePos.clone())}),cc.tween(this.curTarget).to(.5,{x:this.curTargetBasePos.x,y:this.curTargetBasePos.y},cc.easeCubicActionOut()).call(function(){t.root.exportOperationData(t.operation)}).start(),this.curTarget=null,this.curTargetBasePos=null}},t.prototype.addListener=function(){this.root.node.on(cc.Node.EventType.TOUCH_START,this.onTouchBegin,this),this.root.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMoved,this),this.root.node.on(cc.Node.EventType.TOUCH_END,this.onTouchReleased,this),this.root.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchReleased,this)},t.prototype.delListener=function(){this.root.node.off(cc.Node.EventType.TOUCH_START,this.onTouchBegin,this),this.root.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMoved,this),this.root.node.off(cc.Node.EventType.TOUCH_END,this.onTouchReleased,this),this.root.node.off(cc.Node.EventType.TOUCH_CANCEL,this.onTouchReleased,this)},t.prototype.onTouchBegin=function(t){var e=this;if(!this.operateLock){this.removeLayoutFromRoot();var o=t.getLocation();this.root.rootNode.children.forEach(function(t){var n=t.getComponent(cc.Label).string;if(!e.getCorrect(n)){var r=t.getBoundingBoxToWorld();!e.curTarget&&r.contains(o)&&(e.curTarget=t,e.curTargetBasePos=e.curTarget.getPosition(),cc.log("get target, name: "+e.curTarget.getComponent(cc.Label).string))}})}},t.prototype.onTouchMoved=function(t){this.operateLock||this.curTarget&&(this.curTarget.x+=t.getDeltaX(),this.curTarget.y+=t.getDeltaY())},t.prototype.onTouchReleased=function(t){var e=this;if(!this.operateLock){if(this.curTarget){var o=t.getLocation();this.operation.step++;var n,r=this.curTarget.getComponent(cc.Label).string,i=this.operation.data,c=!1,s=[];if(this.root.questionNode.children.forEach(function(t,i){var a=t.getBoundingBoxToWorld();if(e.curTarget&&a.contains(o))n=e.root.rootNode.convertToNodeSpaceAR(t.convertToWorldSpaceAR(cc.Vec3.ZERO)),cc.tween(e.curTarget).to(.25,{x:n.x,y:n.y},cc.easeCubicActionOut()).start(),i==e.curRoundData.correctAnswer.split(" ").indexOf(r)&&(c=!0);else{var u=e.curTarget.getBoundingBoxToWorld();if(u.intersects(a)){var h=new cc.Rect;u.intersection(h,a),s.push({item:t,rect:h,index:i})}}}),!c&&s.length>0){for(var a=void 0,u=0;u<s.length;){if(a){var h=s[u].rect.size,p=h.width*h.height,d=a.rect.size;d.width*d.height<p&&(a=s[u])}else a=s[u];u++}a&&(n=this.root.rootNode.convertToNodeSpaceAR(a.item.convertToWorldSpaceAR(cc.Vec3.ZERO)),cc.tween(this.curTarget).to(.25,{x:n.x,y:n.y},cc.easeCubicActionOut()).start(),a.index==this.curRoundData.correctAnswer.split(" ").indexOf(r)&&(c=!0))}i.forEach(function(t){t.content==r&&(t.correct=c,t.position=n?cc.v2(n.x>>0,n.y>>0):cc.v2(e.curTarget.x>>0,e.curTarget.y>>0))}),c||null==n||(this.root.playersHurt(),this.backToBase()),this.root.exportOperationData(this.operation),this.checkAllCorrect()}this.curTarget=null}},t.prototype.resumeGameStatus=function(){var t=this;this.curRound=this.operation.round,this.curRoundData=n.Config.data[this.curRound],this.createRoundElement(),this.step=this.operation.step,this.root.rootNode.children.forEach(function(e){t.resumePosition(e)})},t.prototype.resumePosition=function(t){var e=t.getComponent(cc.Label).string;this.operation.data.forEach(function(o){e==o.content&&t.setPosition(o.position)})},t.prototype.gameStart=function(){this.curRound=0,this.curRoundData=n.Config.data[this.curRound],this.createRoundElement()},t.prototype.nextRound=function(){this.operateLock=!1,this.curTarget=null,this.curTargetBasePos=null,this.curRound++,this.curRound>=n.Config.data.length&&(this.curRound=0),this.curRoundData=n.Config.data[this.curRound],this.root.rootNode.removeAllChildren(),this.root.questionNode.removeAllChildren(),this.operation=null,this.createRoundElement()},t.prototype.createRoundElement=function(){if(this.addItemToRoot(),this.addItemToQuestion(),!this.operation){this.addLayoutToRoot(),this.step=0;var t=[];this.root.rootNode.children.forEach(function(e){t.push({content:e.getComponent(cc.Label).string,position:cc.v2(e.x>>0,e.y>>0),correct:!1})}),this.operation={round:this.curRound,step:this.step,data:t},this.root.exportOperationData(this.operation)}},t.prototype.addLayoutToRoot=function(){if(this.root.rootNode){var t=this.root.rootNode.addComponent(cc.Layout);t.resizeMode=cc.Layout.ResizeMode.CONTAINER,t.type=cc.Layout.Type.HORIZONTAL,t.spacingX=32,t.updateLayout()}},t.prototype.removeLayoutFromRoot=function(){this.root.rootNode.removeComponent(cc.Layout)},t.prototype.addItemToRoot=function(){for(var t=this.curRoundData.questions.length,e=0;e<t;){var o=new cc.Node;o.addComponent(cc.Label).string=this.curRoundData.questions[e],o.name="box"+e,this.root.rootNode&&(o.parent=this.root.rootNode),e++}},t.prototype.addItemToQuestion=function(){for(var t=this.curRoundData.questions.length,e=0;e<t;)cc.instantiate(this.root.itemPrefab).parent=this.root.questionNode,e++},t.prototype.synchronous=function(t){var e=this;this.operation?(this.operation.round=t.round,this.step=this.operation.step=t.step,t.data.forEach(function(t,o){t.content==e.operation.data[o].content&&(e.operation.data[o].position.equals(t.position)||(e.syncItemPosition(t),e.operation.data[o].position=t.position.clone()))})):(this.operation=t,this.resumeGameStatus())},t.prototype.syncItemPosition=function(t){this.root.rootNode.children.forEach(function(e){e.getComponent(cc.Label).string==t.content&&cc.tween(e).to(.5,{x:t.position.x,y:t.position.y},cc.easeCubicActionOut()).start()})},t.prototype.getCorrect=function(t){var e=!1;return this.operation.data.forEach(function(o){o.content==t&&(e=o.correct)}),e},t.prototype.checkAllCorrect=function(){var t=!0;this.operation.data.forEach(function(e){t&&(t=e.correct)}),t&&this.root.sentenceComplete()},t}();o.default=r,cc._RF.pop()},{"./Config":"Config"}],MakeASentence:[function(t,e,o){"use strict";cc._RF.push(e,"75b66DIknBJ84XES7ar8Uwp","MakeASentence");var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=t("./Delegate"),s=cc._decorator,a=s.ccclass,u=s.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.itemPrefab=null,e.teacherNode=null,e.lockOperation=null,e.freeOperation=null,e.studentStatus=null,e}return r(e,t),e.prototype.onLoad=function(){this.rootNode=this.node.getChildByName("rootNode"),this.questionNode=this.node.getChildByName("questionNode"),this.delegate=new c.default(this)},e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.delegate.onDestroy(),this.delegate=null,this.content&&this.content.onGameComplete()},e.prototype.start=function(){this.content&&this.content.onGameReady(),this.teacherNode.active=this.isTeacher,this.studentStatus.node.active=!this.isTeacher,this.studentStatus.string="freeOperation",this.delegate.start()},e.prototype.setParams=function(t){cc.log("set params: "+JSON.stringify(t)),this.isTeacher=t.isTeacher||!1},e.prototype.setContent=function(t){this.content=t},e.prototype.receiveMessage=function(t){cc.log("receiveMessage: "+t);var e=JSON.parse(t);if(e.isTeacher){if(!this.isTeacher)switch(e.actionData){case"nextRound":this.delegate.nextRound();break;case"lockOperation":this.delegate.setOperationLock(),this.studentStatus.string="lockOperation";break;case"freeOperation":this.delegate.setOperationFree(),this.studentStatus.string="freeOperation"}}else this.isTeacher&&this.delegate.synchronous(e.actionData)},e.prototype.playersHurt=function(){cc.log("playersHurt")},e.prototype.sentenceComplete=function(){cc.log("sentenceComplete")},e.prototype.exportOperationData=function(t){var e={isTeacher:this.isTeacher,actionData:t};this.content&&this.content.postMessage(JSON.stringify(e))},e.prototype.onNextRound=function(){var t={isTeacher:this.isTeacher,actionData:"nextRound"};this.content&&this.content.postMessage(JSON.stringify(t)),cc.log("onNextRound")},e.prototype.onToggleSwitch=function(){var t={isTeacher:this.isTeacher,actionData:""};this.lockOperation.isChecked?(t.actionData="lockOperation",cc.log("lockOperation")):(t.actionData="freeOperation",cc.log("freeOperation")),this.content&&this.content.postMessage(JSON.stringify(t))},i([u(cc.Prefab)],e.prototype,"itemPrefab",void 0),i([u(cc.Node)],e.prototype,"teacherNode",void 0),i([u(cc.Toggle)],e.prototype,"lockOperation",void 0),i([u(cc.Toggle)],e.prototype,"freeOperation",void 0),i([u(cc.Label)],e.prototype,"studentStatus",void 0),i([a],e)}(cc.Component);o.default=h,cc._RF.pop()},{"./Delegate":"Delegate"}]},{},["Config","Delegate","MakeASentence"]);