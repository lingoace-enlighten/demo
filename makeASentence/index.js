window.__require=function t(e,o,i){function n(s,c){if(!o[s]){if(!e[s]){var a=s.split("/");if(a=a[a.length-1],!e[a]){var p="function"==typeof __require&&__require;if(!c&&p)return p(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+s+"'")}s=a}var u=o[s]={exports:{}};e[s][0].call(u.exports,function(t){return n(e[s][1][t]||t)},u,u.exports,t,e,o,i)}return o[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<i.length;s++)n(i[s]);return n}({AnswerItem:[function(t,e,o){"use strict";cc._RF.push(e,"de911k7qNBBNI2WXjopCaSw","AnswerItem");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(s=(r<3?n(s):r>3?n(e,o,s):n(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,c=s.ccclass,a=s.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e}var o;return n(e,t),o=e,e.prototype.setString=function(t){this.label.string=t},e.prototype.getString=function(){return this.label.string},e.prototype.isValueEqual=function(t){return t.getString()==this.getString()},e.prototype.onDestroy=function(){this.unuse(),kit.pool.PrefabPool.put(this.node,"answerItem",o)},e.prototype.reuse=function(){cc.log("reuse item")},e.prototype.unuse=function(){cc.log("unuse item")},r([a(cc.Label)],e.prototype,"label",void 0),o=r([c],e)}(cc.Component);o.default=p,cc._RF.pop()},{}],Config:[function(t,e,o){"use strict";cc._RF.push(e,"7d259bcpq1GepgSPh9U8W5v","Config"),Object.defineProperty(o,"__esModule",{value:!0}),o.Config=void 0,o.Config={data:[{index:0,correctAnswer:"What's your name",questions:["your","name","What's"],stopCode:"?"},{index:1,correctAnswer:"How old are you",questions:["old","you","are","How"],stopCode:"?"},{index:2,correctAnswer:"I am seven",questions:["am","I","seven"],stopCode:"."},{index:3,correctAnswer:"Raise your hand please",questions:["please","your","Raise","hand"],stopCode:"."},{index:4,correctAnswer:"Be quiet please",questions:["quiet","Be","please"],stopCode:"."}]},cc._RF.pop()},{}],Delegate:[function(t,e,o){"use strict";cc._RF.push(e,"c986aZS7eJF9LbSvqvx3QPN","Delegate"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./AnswerItem"),n=t("./Config"),r=t("./QuestionItem"),s=function(){function t(t){this.lastOpTime=0,this.tipSpaceTime=5e3,this.root=t,this.operateLock=!1}return t.prototype.start=function(){var t=this;this.addListener(),this.root.isTeacher||(this.operation?this.resumeGameStatus():this.gameStart(),this.root.scheduleOnce(function(){var e=t.root.questionNode.children[2].convertToWorldSpaceAR(cc.Vec3.ZERO);e=t.root.node.convertToNodeSpaceAR(cc.v2(e.x,e.y));var o=t.root.rootNode.children[0].convertToWorldSpaceAR(cc.Vec3.ZERO);o=t.root.node.convertToNodeSpaceAR(cc.v2(o.x,o.y)),t.root.guildHand(e,o)},.5))},t.prototype.onDestroy=function(){this.delListener(),this.root=null,this.operation=null,this.curRoundData=null,this.curTarget=null,this.curTargetBasePos=null},t.prototype.setOperationLock=function(){this.operateLock=!0,this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.backToBase()},t.prototype.setOperationFree=function(){var t=this;this.operateLock=!1,this.step>0&&(this.timeout=setTimeout(function(){t.checkShowOpTip()},this.tipSpaceTime))},t.prototype.checkShowOpTip=function(){var t=Date.now();if(t-this.lastOpTime>=this.tipSpaceTime){this.lastOpTime=t;var e=[];this.operation.data.forEach(function(t){t.correct||e.push(t.content)}),this.root.tipShow(e)}},t.prototype.backToBase=function(){var t=this;if(this.curTarget&&this.curTargetBasePos){var e=this.operation.data,o=this.curTarget.getComponent(r.default).getString();e.forEach(function(e){e.content==o&&(e.position=t.curTargetBasePos.clone())}),cc.tween(this.curTarget).to(.5,{x:this.curTargetBasePos.x,y:this.curTargetBasePos.y},cc.easeCubicActionOut()).call(function(){t.root.exportOperationData(t.operation)}).start(),this.curTarget=null,this.curTargetBasePos=null}},t.prototype.addListener=function(){this.root.node.on(cc.Node.EventType.TOUCH_START,this.onTouchBegin,this),this.root.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMoved,this),this.root.node.on(cc.Node.EventType.TOUCH_END,this.onTouchReleased,this),this.root.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchReleased,this)},t.prototype.delListener=function(){this.root.node.off(cc.Node.EventType.TOUCH_START,this.onTouchBegin,this),this.root.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMoved,this),this.root.node.off(cc.Node.EventType.TOUCH_END,this.onTouchReleased,this),this.root.node.off(cc.Node.EventType.TOUCH_CANCEL,this.onTouchReleased,this)},t.prototype.onTouchBegin=function(t){var e=this;if(!this.operateLock){this.root.stopHand(),this.root.stopTip(),this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.removeLayoutFromRoot();var o=t.getLocation();this.root.questionNode.children.forEach(function(t){var i=t.getComponent(r.default).getString();if(!e.getCorrect(i)){var n=t.getBoundingBoxToWorld();!e.curTarget&&n.contains(o)&&(e.curTarget=t,e.curTargetBasePos=e.curTarget.getPosition(),e.curTarget.setSiblingIndex(e.root.questionNode.childrenCount-1),cc.log("get target, name: "+i))}})}},t.prototype.onTouchMoved=function(t){this.operateLock||this.curTarget&&(this.curTarget.x+=t.getDeltaX(),this.curTarget.y+=t.getDeltaY())},t.prototype.onTouchReleased=function(t){var e=this;if(!this.operateLock){if(this.curTarget){var o=t.getLocation();this.operation.step++;var i,n=this.curTarget.getComponent(r.default).getString(),s=this.operation.data,c=!1,a=[];if(this.root.rootNode.children.forEach(function(t,r){var s=t.getBoundingBoxToWorld();if(e.curTarget&&s.contains(o))i=e.root.questionNode.convertToNodeSpaceAR(t.convertToWorldSpaceAR(cc.Vec3.ZERO)),cc.tween(e.curTarget).to(.25,{x:i.x,y:i.y},cc.easeCubicActionOut()).start(),r==e.curRoundData.correctAnswer.split(" ").indexOf(n)&&(c=!0);else{var p=e.curTarget.getBoundingBoxToWorld();if(p.intersects(s)){var u=new cc.Rect;p.intersection(u,s),a.push({item:t,rect:u,index:r})}}}),!c&&a.length>0){for(var p=void 0,u=0;u<a.length;){if(p){var h=a[u].rect.size,l=h.width*h.height,d=p.rect.size;d.width*d.height<l&&(p=a[u])}else p=a[u];u++}p&&(i=this.root.questionNode.convertToNodeSpaceAR(p.item.convertToWorldSpaceAR(cc.Vec3.ZERO)),cc.tween(this.curTarget).to(.25,{x:i.x,y:i.y},cc.easeCubicActionOut()).start(),p.index==this.curRoundData.correctAnswer.split(" ").indexOf(n)&&(c=!0))}s.forEach(function(t){t.content==n&&(t.correct=c,t.position=i?cc.v2(i.x>>0,i.y>>0):cc.v2(e.curTarget.x>>0,e.curTarget.y>>0))}),this.root.exportOperationData(this.operation),c||(this.root.playersHurt(),this.backToBase()),this.checkAllCorrect()}this.curTarget=null,this.timeout=setTimeout(function(){e.checkShowOpTip()},this.tipSpaceTime)}},t.prototype.resumeGameStatus=function(){var t=this;this.curRound=this.operation.round,this.curRoundData=n.Config.data[this.curRound],this.createRoundElement(),this.step=this.operation.step,this.root.questionNode.children.forEach(function(e){t.resumePosition(e)})},t.prototype.resumePosition=function(t){var e=t.getComponent(r.default).getString();this.operation.data.forEach(function(o){e==o.content&&t.setPosition(o.position)})},t.prototype.gameStart=function(){this.curRound=0,this.curRoundData=n.Config.data[this.curRound],this.createRoundElement()},t.prototype.nextRound=function(){this.operateLock=!1,this.curTarget=null,this.curTargetBasePos=null,this.curRound++,this.curRound>=n.Config.data.length?this.root.sentenceComplete(!0):(this.curRoundData=n.Config.data[this.curRound],this.root.rootNode.removeAllChildren(),this.root.questionNode.removeAllChildren(),this.operation=null,this.createRoundElement())},t.prototype.createRoundElement=function(){var t=this;if(this.addItemToQuestion(),this.addItemToRoot(),!this.operation){this.addLayoutToRoot(),this.step=0;var e=[];this.root.questionNode.children.forEach(function(t){e.push({content:t.getComponent(r.default).getString(),position:cc.v2(t.x>>0,t.y>>0),correct:!1})}),this.operation={round:this.curRound,step:this.step,data:e},this.root.exportOperationData(this.operation),this.root.scheduleOnce(function(){t.removeLayoutFromRoot()},.5)}},t.prototype.addLayoutToRoot=function(){if(this.root.questionNode){var t=this.root.questionNode.addComponent(cc.Layout);t.resizeMode=cc.Layout.ResizeMode.CONTAINER,t.type=cc.Layout.Type.GRID,t.startAxis=cc.Layout.AxisDirection.HORIZONTAL,t.spacingX=58,t.spacingY=40,t.updateLayout()}},t.prototype.removeLayoutFromRoot=function(){this.root.questionNode.removeComponent(cc.Layout)},t.prototype.addItemToRoot=function(){for(var t=this.curRoundData.correctAnswer.split(" "),e=t.length,o=0;o<e;){var n=kit.pool.PrefabPool.get(this.root.answerPrefab,"answerItem",i.default);t[o].includes(this.curRoundData.stopCode)?n.getComponent(i.default).setString(t[o].substring(0,t[o].length-1)):n.getComponent(i.default).setString(t[o]),this.root.rootNode&&(n.parent=this.root.rootNode),o++}this.root.stopCode.string=this.curRoundData.stopCode},t.prototype.addItemToQuestion=function(){for(var t=this.curRoundData.questions.length,e=0;e<t;){var o=kit.pool.PrefabPool.get(this.root.questionPrefab,"questionItem",r.default);o.getComponent(r.default).setString(this.curRoundData.questions[e]),o.parent=this.root.questionNode,e++}},t.prototype.synchronous=function(t){if(this.operation){this.operation.round=t.round,this.step=this.operation.step=t.step;for(var e=t.data,o=0;o<e.length;){var i=e[o];i&&this.operation.data[o]&&i.content==this.operation.data[o].content&&(this.operation.data[o].position.x==i.position.x&&this.operation.data[o].position.y==i.position.you||(this.syncItemPosition(i),this.operation.data[o].position.x=i.position.x,this.operation.data[o].position.y=i.position.y)),o++}}else this.operation=t,this.resumeGameStatus()},t.prototype.syncItemPosition=function(t){this.root.questionNode.children.forEach(function(e){e.getComponent(r.default).getString()==t.content&&cc.tween(e).to(.5,{x:t.position.x,y:t.position.y},cc.easeCubicActionOut()).start()})},t.prototype.getCorrect=function(t){var e=!1;return this.operation.data.forEach(function(o){o.content==t&&(e=o.correct)}),e},t.prototype.checkAllCorrect=function(){var t=!0;this.operation.data.forEach(function(e){t&&(t=e.correct)}),t&&(this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.root.hideLaser(this.operation.round),this.root.sentenceComplete())},t}();o.default=s,cc._RF.pop()},{"./AnswerItem":"AnswerItem","./Config":"Config","./QuestionItem":"QuestionItem"}],IItem:[function(t,e,o){"use strict";cc._RF.push(e,"86e5arO89pFsLVBZpQgK5bu","IItem"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],MakeASentenceScript:[function(t,e,o){"use strict";cc._RF.push(e,"75b66DIknBJ84XES7ar8Uwp","MakeASentenceScript");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(s=(r<3?n(s):r>3?n(e,o,s):n(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=t("./Delegate"),c=t("./QuestionItem"),a=cc._decorator,p=a.ccclass,u=a.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.answerPrefab=null,e.questionPrefab=null,e.rootNode=null,e.stopCode=null,e.questionNode=null,e.hand=null,e.leftDoor=null,e.rightDoor=null,e.lasers=[],e.max=null,e.melinda=null,e.mili=null,e.dtIndx=0,e.localData=[],e}return n(e,t),e.prototype.onLoad=function(){this.delegate=new s.default(this),this.laserBaseOpacity=[];for(var t=0;t<this.lasers.length;){var e=this.lasers[t];this.laserBaseOpacity.push(e.node.opacity),e.node.opacity=0,t++}this.startTime||(this.startTime=Date.now())},e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.delegate.onDestroy(),this.delegate=null},e.prototype.start=function(){this.content&&this.content.onGameReady();var t=cc.sys.localStorage.getItem("operation");t&&(this.isTeacher=!0,this.localData=JSON.parse(t)),this.isTeacher&&this.delegate.setOperationLock(),this.playIdle(),this.showLasers(this.onStart.bind(this))},e.prototype.onStart=function(){this.delegate.start()},e.prototype.update=function(){if(this.isTeacher&&this.localData&&this.dtIndx<this.localData.length){var t=Date.now();this.startTime||(this.startTime=t),this.curDt||(this.curDt=this.localData[this.dtIndx],cc.log("dtIdx:"+this.dtIndx+", dt:"+JSON.stringify(this.curDt)),this.nextTickTime=this.startTime+this.curDt.duration,cc.log("curNow:"+t+", nextTickTime:"+this.nextTickTime)),Math.abs(t-this.nextTickTime)<=16&&(this.delegate.synchronous(this.cloneActDt(this.curDt.actionData)),this.dtIndx++,this.curDt=null)}},e.prototype.cloneActDt=function(t){return JSON.parse(JSON.stringify(t))},e.prototype.setParams=function(t){cc.log("set params: "+JSON.stringify(t)),this.isTeacher=t.isTeacher||!1},e.prototype.setContent=function(t){this.content=t},e.prototype.receiveMessage=function(t){cc.log("receiveMessage: "+t);var e=JSON.parse(t);if(e.isTeacher){if(!this.isTeacher)switch(e.actionData){case"nextRound":this.delegate.nextRound()}}else this.isTeacher&&this.delegate.synchronous(e.actionData)},e.prototype.showLasers=function(t){var e=this,o=this,i=0;this.lasers.forEach(function(n,r){n.node.active=!0,cc.tween(n).delay(.2*r).call(function(){n.node.opacity=e.laserBaseOpacity[r],o.playSpine(n,"appear",!1,function(){o.playSpine(n,"idle",!0),++i==o.lasers.length&&t&&t.apply(null)})}).start()})},e.prototype.hideLaser=function(t){var e=this;this.lasers.forEach(function(o,i){t==i&&e.playSpine(o,"disappear",!1,function(){o.node.active=!1})})},e.prototype.guildHand=function(t,e){this.hand&&(this.hand.active=!0,cc.tween(this.hand).repeatForever(cc.tween().set({x:t.x,y:t.y}).to(1.5,{x:e.x,y:e.y},cc.easeCubicActionOut()).delay(.5)).start())},e.prototype.stopHand=function(){cc.Tween.stopAllByTarget(this.hand),this.hand.active=!1},e.prototype.tipShow=function(t){this.questionNode.children.forEach(function(e){t.includes(e.getComponent(c.default).getString())&&e.getComponent(c.default).showTip()})},e.prototype.stopTip=function(){this.questionNode.children.forEach(function(t){t.getComponent(c.default).hideTip()})},e.prototype.playIdle=function(){this.playSpine(this.max,"idle",!0),this.playSpine(this.melinda,"daiji",!0),this.playSpine(this.mili,"daiji",!0)},e.prototype.playersHurt=function(){var t=this;cc.log("playersHurt"),this.playSpine(this.max,"shiluo",!1,function(){t.playSpine(t.max,"idle",!0)}),this.playSpine(this.melinda,"fu_fk",!1,function(){t.playSpine(t.melinda,"daiji",!0)}),this.playSpine(this.mili,"fu_fankui",!1,function(){t.playSpine(t.mili,"daiji",!0)})},e.prototype.sentenceComplete=function(t){var e=this;void 0===t&&(t=!1),cc.log("sentenceComplete"),t?(this.playSpine(this.max,"qinzhu",!1,function(){e.playSpine(e.max,"idle",!0)}),this.playSpine(this.melinda,"qingzhu",!1,function(){e.playSpine(e.melinda,"daiji",!0)}),this.playSpine(this.mili,"qingzhu",!1,function(){e.playSpine(e.mili,"daiji",!0)}),this.openTheDoor()):(this.playSpine(this.max,"kaixin",!1,function(){e.playSpine(e.max,"idle",!0)}),this.playSpine(this.melinda,"zheng_fk",!1,function(){e.playSpine(e.melinda,"daiji",!0)}),this.playSpine(this.mili,"zheng_fk",!1,function(){e.playSpine(e.mili,"daiji",!0)}),this.scheduleOnce(this.onNextRound.bind(this),2))},e.prototype.openTheDoor=function(){var t=this;cc.tween(this.leftDoor).to(1,{x:-164},cc.easeCubicActionOut()).start(),cc.tween(this.rightDoor).to(1,{x:164},cc.easeCircleActionOut()).delay(2).call(function(){t.content&&t.content.onGameComplete(),t.localData&&cc.sys.localStorage.setItem("operation",JSON.stringify(t.localData))}).start()},e.prototype.exportOperationData=function(t){var e={isTeacher:this.isTeacher,actionData:t,duration:Date.now()-this.startTime};this.content&&this.content.postMessage(JSON.stringify(e)),!this.isTeacher&&this.localData.push(e)},e.prototype.onNextRound=function(){var t={isTeacher:this.isTeacher,actionData:"nextRound"};this.content&&this.content.postMessage(JSON.stringify(t)),this.delegate&&this.delegate.nextRound(),cc.log("onNextRound")},e.prototype.onToggleSwitch=function(){var t={isTeacher:this.isTeacher,actionData:""};this.content&&this.content.postMessage(JSON.stringify(t))},e.prototype.playSpine=function(t,e,o,i){void 0===o&&(o=!1),t&&t.animation!=e&&(t.clearTracks(),t.setToSetupPose(),t.setAnimation(0,e,o),i&&t.setCompleteListener(i))},r([u(cc.Prefab)],e.prototype,"answerPrefab",void 0),r([u(cc.Prefab)],e.prototype,"questionPrefab",void 0),r([u(cc.Node)],e.prototype,"rootNode",void 0),r([u(cc.Label)],e.prototype,"stopCode",void 0),r([u(cc.Node)],e.prototype,"questionNode",void 0),r([u(cc.Node)],e.prototype,"hand",void 0),r([u(cc.Node)],e.prototype,"leftDoor",void 0),r([u(cc.Node)],e.prototype,"rightDoor",void 0),r([u([sp.Skeleton])],e.prototype,"lasers",void 0),r([u(sp.Skeleton)],e.prototype,"max",void 0),r([u(sp.Skeleton)],e.prototype,"melinda",void 0),r([u(sp.Skeleton)],e.prototype,"mili",void 0),r([p],e)}(cc.Component);o.default=h,cc._RF.pop()},{"./Delegate":"Delegate","./QuestionItem":"QuestionItem"}],QuestionItem:[function(t,e,o){"use strict";cc._RF.push(e,"a4ec2E+YkNGQ504oIEscwLh","QuestionItem");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(s=(r<3?n(s):r>3?n(e,o,s):n(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=t("./AnswerItem"),c=cc._decorator,a=c.ccclass,p=(c.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}var o;return n(e,t),o=e,e.prototype.showTip=function(){cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).repeatForever(cc.tween(this.node).to(.5,{scale:1.2},cc.easeCubicActionOut()).delay(.2).to(.5,{scale:1},cc.easeCubicActionOut())).start()},e.prototype.hideTip=function(){cc.Tween.stopAllByTarget(this.node),this.node.scale=1},e.prototype.onDestroy=function(){this.unuse(),kit.pool.PrefabPool.put(this.node,"questionItem",o)},e.prototype.reuse=function(){cc.log("QuestionItem reuse item")},e.prototype.unuse=function(){cc.log("QuestionItem un use")},o=r([a],e)}(s.default));o.default=p,cc._RF.pop()},{"./AnswerItem":"AnswerItem"}]},{},["AnswerItem","Config","Delegate","IItem","MakeASentenceScript","QuestionItem"]);