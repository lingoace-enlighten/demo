window.__require=function t(i,e,o){function n(a,r){if(!e[a]){if(!i[a]){var c=a.split("/");if(c=c[c.length-1],!i[c]){var h="function"==typeof __require&&__require;if(!r&&h)return h(c,!0);if(s)return s(c,!0);throw new Error("Cannot find module '"+a+"'")}a=c}var d=e[a]={exports:{}};i[a][0].call(d.exports,function(t){return n(i[a][1][t]||t)},d,d.exports,t,i,e,o)}return e[a].exports}for(var s="function"==typeof __require&&__require,a=0;a<o.length;a++)n(o[a]);return n}({L1W6D4Game22Config:[function(t,i,e){"use strict";cc._RF.push(i,"56096lgVTFOubz59Oylb3+X","L1W6D4Game22Config"),Object.defineProperty(e,"__esModule",{value:!0}),e.TigoAniNameConfig=e.AudioNameConfig=void 0,function(t){t.Its_a_chair_ytz="res/audios/Its_a_chair_ytz",t.Its_a_table_ytz="res/audios/Its_a_table_ytz",t.Listen_and_say_ytz="res/audios/Listen_and_say_ytz",t.huanhu="res/audios/huanhu",t.SE_dongwumiaobian_01="res/audios/SE_dongwumiaobian_01",t.SE_dongwumiaobian_02="res/audios/SE_dongwumiaobian_02",t.BGM_yamamazhaodan_01_ytz="res/audios/BGM_yamamazhaodan_01_ytz"}(e.AudioNameConfig||(e.AudioNameConfig={})),function(t){t.tigo_xie_daiji="tigo_xie_daiji",t.tigo_xie_huanhu="tigo_xie_huanhu"}(e.TigoAniNameConfig||(e.TigoAniNameConfig={})),cc._RF.pop()},{}],L1W6D4Game22Main:[function(t,i,e){"use strict";cc._RF.push(i,"a48ef4rEY9NUbqtGKdhf008","L1W6D4Game22Main");var o,n=this&&this.__extends||(o=function(t,i){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])})(t,i)},function(t,i){function e(){this.constructor=t}o(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}),s=this&&this.__decorate||function(t,i,e,o){var n,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,i,e,o);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(a=(s<3?n(a):s>3?n(i,e,a):n(i,e))||a);return s>3&&a&&Object.defineProperty(i,e,a),a},a=this&&this.__awaiter||function(t,i,e,o){return new(e||(e=Promise))(function(n,s){function a(t){try{c(o.next(t))}catch(i){s(i)}}function r(t){try{c(o.throw(t))}catch(i){s(i)}}function c(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(a,r)}c((o=o.apply(t,i||[])).next())})},r=this&&this.__generator||function(t,i){var e,o,n,s,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function r(t){return function(i){return c([t,i])}}function c(s){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,o&&(n=2&s[0]?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,o=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){a.label=s[1];break}if(6===s[0]&&a.label<n[1]){a.label=n[1],n=s;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(s);break}n[2]&&a.ops.pop(),a.trys.pop();continue}s=i.call(t,a)}catch(r){s=[6,r],o=0}finally{e=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};Object.defineProperty(e,"__esModule",{value:!0});var c=t("./L1W6D4Game22Config"),h=t("../../../module/component/scripts/GameCompBase"),d=t("../../../module/kit/event/ListenerManager"),u=t("../../../module/kit/event/BaseEvent"),p=t("../../../module/kit/TigoManager"),l=t("../../../module/kit/audio/AudioManager"),g=cc._decorator,f=g.ccclass,y=g.property,_=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.bg=null,i.mask=null,i.uiNode=null,i.card=null,i.graphics2=null,i.tigoSpine=null,i.displayNode=[],i.shadingNode=[],i.sceneContentNode=null,i.guildStartNode=[],i.guildEndNode=[],i.hand=null,i.graphics=null,i.percent={f:0,i:0},i.lines=[],i.currPos=cc.Vec2.ZERO,i.lastPos=cc.Vec2.ZERO,i.lineWidth=40,i.wipeComplete=!1,i.isDragging=!1,i.completePer=60,i.grid=[],i.rectWidth=50,i.isDebug=!1,i.curIndex=-1,i.maxRound=2,i.audioConfig=[c.AudioNameConfig.Its_a_table_ytz,c.AudioNameConfig.Its_a_chair_ytz],i.displayWord=["It's a table.","It's a chair."],i.followWord=["It's a table","It's a chair"],i.followImage=["follow_desk","follow_chairs"],i}return n(i,t),i.prototype.onLoad=function(){return a(this,void 0,void 0,function(){var i;return r(this,function(e){switch(e.label){case 0:return t.prototype.onLoad.call(this),this.graphics=this.mask.getComponent(cc.Mask)._graphics,this.graphics.lineWidth=this.lineWidth,this.graphics.lineCap=cc.Graphics.LineCap.ROUND,this.graphics.lineJoin=cc.Graphics.LineJoin.ROUND,this.bg.on(cc.Node.EventType.TOUCH_START,this.onTouchBegan,this),this.bg.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.bg.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.bg.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),d.ListenerManager.on(u.BaseEvent.EVENT_FOLLOW_UP_RIGHT,this.playRight,this),d.ListenerManager.on(u.BaseEvent.EVENT_FOLLOW_UP_WRONG,this.playWrong,this),this.initRecordComponent(),i=this,[4,this.initHandComponent(.8)];case 1:return i.hand=e.sent(),[2]}})})},i.prototype.onGameStart=function(){l.default.playMusic(this.bundleName,c.AudioNameConfig.BGM_yamamazhaodan_01_ytz),this.roundStart()},i.prototype.initData=function(){},i.prototype.roundStart=function(){var t=this;this.curIndex++,this.curIndex>=this.maxRound?this.gameEnd():(this.genGrids(),this.wipeComplete=!1,this.graphics.clear(),this.uiNode.active=!0,this.displayNode[this.curIndex].active=!0,this.shadingNode[this.curIndex].active=!0,this.playSpineAsync(this.tigoSpine,c.TigoAniNameConfig.tigo_xie_daiji,!0),this.scheduleOnce(function(){t.showTipsCallback()}))},i.prototype.roundEnd=function(){this.roundStart()},i.prototype.wipeEnd=function(){var t=this;this.wipeComplete=!0,this.shadingNode[this.curIndex].active=!1,cc.log(" ====wipeEnd"),this.scheduleOnce(function(){t.displayNode[t.curIndex].active=!1,t.shadingNode[t.curIndex].active=!1,t.uiNode.active=!1,t.record()},1)},i.prototype.createShowTips=function(){this.cancelShowTips(),this.scheduleOnce(this.showTipsCallback,5)},i.prototype.cancelShowTips=function(){this.unschedule(this.showTipsCallback),this.hand.node.active=!1,this.hand.stopCycleAllAction()},i.prototype.showTipsCallback=function(){this.hand.wipeCycle(cc.v2(this.guildStartNode[this.curIndex].position),cc.v2(this.guildEndNode[this.curIndex].position)),this.hand.node.active=!0},i.prototype.record=function(){d.ListenerManager.dispatch(u.BaseEvent.EVENT_FOLLOW_UP,{text:this.followWord[this.curIndex],textString:this.displayWord[this.curIndex],word:!0,img:"res/images/"+this.followImage[this.curIndex],imgScale:0==this.curIndex?.4:.6,music:""+this.audioConfig[this.curIndex],time:3})},i.prototype.playRight=function(){return a(this,void 0,void 0,function(){var t=this;return r(this,function(i){switch(i.label){case 0:return cc.log("====playRight==="),p.default.callAppToCollect(this.curIndex,1004,3),this.uiNode.active=!1,this.displayNode[this.curIndex].active=!1,0==this.curIndex?this.sceneContentNode.getChildByName("zhuozi").active=!0:1==this.curIndex&&(this.sceneContentNode.getChildByName("yizizuo").active=!0,this.sceneContentNode.getChildByName("yiziyou").active=!0),l.default.playEffect(this.bundleName,c.AudioNameConfig.huanhu),[4,this.playSpineAsync(this.tigoSpine,c.TigoAniNameConfig.tigo_xie_huanhu,!1)];case 1:return i.sent(),this.playSpineAsync(this.tigoSpine,c.TigoAniNameConfig.tigo_xie_daiji,!0),this.scheduleOnce(function(){t.roundEnd()},1),[2]}})})},i.prototype.playWrong=function(){cc.log("====playWrong===")},i.prototype.endAniComplete=function(){},i.prototype.onTouchBegan=function(t){if(this.cancelShowTips(),!this.isDragging&&!this.wipeComplete){l.default.playLoopEffect(this.bundleName,c.AudioNameConfig.SE_dongwumiaobian_01),this.isDragging=!0;var i=t.getLocationX(),e=t.getLocationY(),o=this.mask.convertToNodeSpaceAR(cc.v2(i,e));this.currPos.x=o.x,this.currPos.y=o.y,this.lastPos.x=o.x,this.lastPos.y=o.y,this.graphics.lineWidth=this.lineWidth,this.graphics.strokeColor=cc.color(255,255,255,255),this.graphics.moveTo(o.x,o.y)}},i.prototype.onTouchMove=function(t){if(this.isDragging&&!this.wipeComplete){var i=t.getDeltaX(),e=t.getDeltaY();this.currPos.x+=i,this.currPos.y+=e,this.drawLine(this.currPos)}},i.prototype.onTouchEnd=function(){l.default.stopLoopEffect(this.bundleName,c.AudioNameConfig.SE_dongwumiaobian_01),this.wipeComplete?this.isDragging=!1:(this.isDragging=!1,this.createShowTips())},i.prototype.getPercent=function(){for(var t=0,i=0;i<this.grid.length;i++)this.grid[i].hit&&t++;var e=t/this.grid.length,o=Math.ceil(100*e);return o>=this.completePer&&(e=1,o=100),{f:e,i:o}},i.prototype.drawLine=function(t){this.graphics.lineTo(t.x,t.y),this.graphics.stroke(),this.graphics.moveTo(t.x,t.y);var i={start:cc.v2(this.lastPos.x,this.lastPos.y),end:cc.v2(t.x,t.y)};if(this.lines.push(i),this.lastPos.x=t.x,this.lastPos.y=t.y,this.hitRect(i),this.percent=this.getPercent(),this.percent.f>=.9)return l.default.stopLoopEffect(this.bundleName,c.AudioNameConfig.SE_dongwumiaobian_01),l.default.playEffect(this.bundleName,c.AudioNameConfig.SE_dongwumiaobian_02),void this.wipeEnd()},i.prototype.genGrids=function(){for(var t=Math.ceil(this.displayNode[this.curIndex].width/this.rectWidth),i=Math.ceil(this.displayNode[this.curIndex].height/this.rectWidth),e=-this.displayNode[this.curIndex].width/2,o=-this.displayNode[this.curIndex].height/2,n=0;n<i;n++)for(var s=0;s<t;s++){var a=e+s*this.rectWidth-this.rectWidth/4,r=o+n*this.rectWidth-this.rectWidth/4,c=cc.rect(a,r,this.rectWidth,this.rectWidth);this.grid.push({rect:c,hit:!1})}},i.prototype.isRectCrossLine=function(t,i){var e=i.start.x,o=i.start.y,n=i.end.x,s=i.end.y,a=t.x,r=t.y+t.height,c=t.x+t.width,h=t.y,d=o-s,u=n-e,p=e*s-n*o;if(d*a+u*r+p>=0&&d*c+u*h+p<=0||d*a+u*r+p<=0&&d*c+u*h+p>=0||d*a+u*h+p>=0&&d*c+u*r+p<=0||d*a+u*h+p<=0&&d*c+u*r+p>=0){if(a>c){var l=a;a=c,c=l}if(r<h){var g=r;r=h,h=g}return!(e<a&&n<a||e>c&&n>c||o>r&&s>r||o<h&&s<h)}return!1},i.prototype.hitRect=function(t){for(var i=0;i<this.grid.length;i++){var e=this.grid[i];this.isRectCrossLine(e.rect,t)&&(e.hit=!0,this.isDebug&&this.drawCircle(cc.v2(e.rect.x+e.rect.width/2,e.rect.y+e.rect.width/2)))}},i.prototype.drawCircle=function(t){this.graphics2.ellipse(t.x,t.y,this.lineWidth/4,this.lineWidth/4),this.graphics2.fillColor=cc.color(0,0,0,255),this.graphics2.fill()},s([y(cc.Node)],i.prototype,"bg",void 0),s([y(cc.Node)],i.prototype,"mask",void 0),s([y(cc.Node)],i.prototype,"uiNode",void 0),s([y(cc.Sprite)],i.prototype,"card",void 0),s([y(cc.Graphics)],i.prototype,"graphics2",void 0),s([y(sp.Skeleton)],i.prototype,"tigoSpine",void 0),s([y({type:[cc.Node],displayName:"\u522e\u51fa\u6765\u7684\u5185\u5bb9"})],i.prototype,"displayNode",void 0),s([y({type:[cc.Node],displayName:"\u9634\u5f71"})],i.prototype,"shadingNode",void 0),s([y({type:cc.Node,displayName:"\u573a\u666f\u4e2d\u663e\u793a\u8282\u70b9"})],i.prototype,"sceneContentNode",void 0),s([y({type:[cc.Node],displayName:"\u5f00\u59cb\u5f15\u5bfc\u70b9"})],i.prototype,"guildStartNode",void 0),s([y({type:[cc.Node],displayName:"\u7ed3\u675f\u5f15\u5bfc\u70b9"})],i.prototype,"guildEndNode",void 0),s([f],i)}(h.default);e.default=_,cc._RF.pop()},{"../../../module/component/scripts/GameCompBase":void 0,"../../../module/kit/TigoManager":void 0,"../../../module/kit/audio/AudioManager":void 0,"../../../module/kit/event/BaseEvent":void 0,"../../../module/kit/event/ListenerManager":void 0,"./L1W6D4Game22Config":"L1W6D4Game22Config"}]},{},["L1W6D4Game22Config","L1W6D4Game22Main"]);