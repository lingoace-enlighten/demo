window.__require=function t(e,o,n){function i(a,s){if(!o[a]){if(!e[a]){var c=a.split("/");if(c=c[c.length-1],!e[c]){var p="function"==typeof __require&&__require;if(!s&&p)return p(c,!0);if(r)return r(c,!0);throw new Error("Cannot find module '"+a+"'")}a=c}var l=o[a]={exports:{}};e[a][0].call(l.exports,function(t){return i(e[a][1][t]||t)},l,l.exports,t,e,o,n)}return o[a].exports}for(var r="function"==typeof __require&&__require,a=0;a<n.length;a++)i(n[a]);return i}({GameSnailPaShanReprint:[function(t,e,o){"use strict";cc._RF.push(e,"f6137KltLxP5aZw4QDOYiI7","GameSnailPaShanReprint");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,o,a):i(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("./ItemSnailPaShanReprint"),s=cc._decorator,c=s.ccclass,p=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.arrAudio=[],e.arrQues=[],e.arrAnswer=[],e.btnNext=null,e.itemRole=null,e.isLock=!1,e.isFinish=!1,e.quesIndex=0,e.selectItems=[],e.pageNum=0,e.arrNodeForRolePos=[],e.event_game_next="EVENT_GAME_NEXT",e.event_game_touch="EVENT_GAME_TOUDH",e.event_game_end="EVENT_GAME_END",e.reDebug=!1,e.isTeacher=!!e.reDebug,e.dataQues={options:[{answers:[3,0],soundId:0},{answers:[1],soundId:0},{answers:[5],soundId:0},{answers:[2,4],soundId:0}]},e}return i(e,t),e.prototype.onDisable=function(){kit.AudioPlayer.stopAll()},e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.sendMessage(this.event_game_end,{})},e.prototype.start=function(){this.setIsLock(!0),this.initData(),this.resetData(),this.updateUI(),this.nextQuestion()},e.prototype.initData=function(){var t=this.itemRole.parent;this.arrNodeForRolePos=this.getArrByNode(t,"pos")},e.prototype.resetData=function(){var t=this.content&&this.content.getSnapshot?this.content.getSnapshot():{};if(t&&(t=t.actionData),t&&t.cmd&&t.cmd!=this.event_game_end&&t.info&&t.page==this.pageNum){var e=t.info;this.refreshDataForMsg(e),t.cmd===this.event_game_touch&&e.result&&this.updateDataForMsg(e),window.sessionStorage.removeItem("workInfoList")}},e.prototype.updateUI=function(){this.updateUIForRole(),this.updateUIForQues(),this.updateUIForAnswer(),this.updateUIForBtn()},e.prototype.updateUIForRole=function(){var t=this.selectItems.length,e=this.arrNodeForRolePos[t];this.itemRole.position=e.position,this.itemRole.angle=e.angle},e.prototype.updateUIForQues=function(){for(var t=0,e=this.arrQues.length;t<e;t++)this.arrQues[t].active=this.selectItems.indexOf(t)<0},e.prototype.updateUIForAnswer=function(){for(var t=0,e=this.arrAnswer.length;t<e;t++){var o=this.arrAnswer[t];if(o.active=t===this.quesIndex,o.active){var n=this.dataQues.options[t];o.getComponent(a.default).updateUIForLabel(n.answers,this.selectItems)}}},e.prototype.updateUIForBtn=function(){var t=this;if(this.btnNext.active=!1,this.quesIndex<this.dataQues.options.length-1){var e=this.dataQues.options[this.quesIndex].answers.every(function(e){return t.selectItems.includes(e)});this.btnNext.active=!!e&&this.isTeacher}},e.prototype.nextQuestion=function(){var t=this;if(!this.isFinish)if(this.selectItems.length>0)this.setIsLock(!1);else{for(var e=0,o=this.arrQues.length;e<o;e++){var n=this.arrQues[e];if(n.active){var i=n.getChildByName("label");i.opacity=0,cc.tween(i).delay(.5).to(.5,{opacity:255}).start()}}var r=this.arrAnswer[this.quesIndex].getComponent(a.default).arrLabel[0].parent;r.opacity=0,cc.tween(r).delay(.5).to(.5,{opacity:255}).start(),this.scheduleOnce(function(){t.setIsLock(!1)},1)}},e.prototype.eventNext=function(){this.btnNext.active=!1,this.quesIndex++,this.sendMessage(this.event_game_next,{})},e.prototype.msgResultNext=function(t){var e=this;this.setIsLock(!0),this.refreshDataForMsg(t);var o=this.arrAnswer[this.quesIndex-1],n=o.getComponent(a.default).arrLabel[0].parent;n.opacity=255,cc.tween(n).to(.4,{opacity:0}).call(function(){o.active=!1}).start();var i=this.arrAnswer[this.quesIndex],r=i.getComponent(a.default).arrLabel[0].parent;i.active=!0,r.opacity=0,cc.tween(r).delay(.4).to(.4,{opacity:255}).call(function(){e.updateUIForBtn(),e.nextQuestion()}).start()},e.prototype.eventTouch=function(t){if(!this.isLock){var e=this.arrQues.indexOf(t.target.parent);if(!(e<0||this.selectItems.indexOf(e)>=0)){var o=!0,n=this.dataQues.options[this.quesIndex],i=n.answers.indexOf(e);if(i>0){var r=n.answers[i-1];this.selectItems.indexOf(r)<0&&(o=!1)}else i<0&&(o=!1);this.setIsLock(!0),this.sendMessage(this.event_game_touch,{itemId:e,result:o})}}},e.prototype.msgResultTouch=function(t){var e=this;this.setIsLock(!0);var o=t.itemId,n=t.result;if(this.refreshDataForMsg(t),n){var i=function(){e.updateDataForMsg(t),e.isFinish?e.playAniWin():(e.updateUI(),e.dataQues.options[e.quesIndex].answers.every(function(t){return e.selectItems.includes(t)})||e.nextQuestion())};this.playAniSuccess(o,i.bind(this))}else i=function(){e.setIsLock(!1)},this.playAniWrong(o,i.bind(this))},e.prototype.playAniSuccess=function(t,e){var o=this,n=this.arrQues[t],i=function(){kit.AudioPlayer.playEffect(o.arrAudio[2]);var t=o.itemRole.parent.getChildByName("icon");t.active=!0;var e=o.itemRole.position,i=n.getChildByName("icon");i.active=!1,t.position=o.getLocalPos(i,t.parent),t.scale=1.2*i.scale,t.angle=i.angle;var r={position:t.position,scale:t.scale,angle:t.angle},a=cc.v2(r.position.x,r.position.y),s=cc.v2(e.x,e.y+50),c=cc.v2((a.x+s.x)/2,a.y+700),p=cc.tween;p(t).parallel(p().bezierTo(1.5,a,c,s),p().to(.3,{scale:r.scale/1.2}),p().to(1.5,{angle:r.angle+1080})).call(function(){t.active=!1;var e=o.itemRole.scaleX,n=o.itemRole.scaleY,i=o.itemRole.opacity;cc.tween(o.itemRole).to(.13,{scaleX:1.2*e,scaleY:1.2*n,opacity:i-100}).to(.13,{scaleX:e,scaleY:n,opacity:i}).to(.13,{scaleX:1.2*e,scaleY:1.2*n,opacity:i-100}).to(.13,{scaleX:e,scaleY:n,opacity:i}).start()}).start()},r=function(){kit.AudioPlayer.playEffect(o.arrAudio[0]);var t={y:n.y,opacity:n.opacity};cc.tween(n).to(.4,{y:t.y-200,opacity:0}).call(function(){n.y=t.y,n.opacity=t.opacity,n.active=!1}).start()},s=function(){kit.AudioPlayer.playEffect(o.arrAudio[3]);var t=o.arrNodeForRolePos[o.selectItems.length+1],e=cc.tween;e(o.itemRole).parallel(e().to(1.634,{position:t.position}),e().to(1.634,{angle:t.angle})).start()};cc.tween(this.node).call(function(){i()}).delay(1.5).call(function(){r()}).delay(.2).call(function(){var e,n;e=o.dataQues.options[o.quesIndex].answers.indexOf(t),(n=o.arrAnswer[o.quesIndex].getComponent(a.default).arrLabel[e]).active=!0,n.opacity=0,cc.tween(n).to(.4,{opacity:255}).start()}).delay(.4+.2).call(function(){s()}).delay(1.634).call(function(){e()}).start()},e.prototype.playAniWrong=function(t,e){kit.AudioPlayer.playEffect(this.arrAudio[1]);var o=this.arrQues[t];cc.tween(o).to(.2,{angle:-10}).to(.2,{angle:10}).to(.2,{angle:-10}).to(.2,{angle:0}).call(function(){e()}).start()},e.prototype.playAniWin=function(){kit.AudioPlayer.playEffect(this.arrAudio[4])},e.prototype.setIsLock=function(t){this.isLock=t},e.prototype.refreshDataForMsg=function(t){this.quesIndex=t.quesIndex,this.selectItems=t.selectItems},e.prototype.updateDataForMsg=function(t){this.selectItems.push(t.itemId),this.selectItems.length>this.arrQues.length-1&&(this.isFinish=!0)},e.prototype.sendMessage=function(t,e){var o={cmd:t,page:this.pageNum,info:{itemId:0,result:!1,quesIndex:this.quesIndex,selectItems:this.selectItems}};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(o.info[n]=e[n]);var i={isTeacher:this.isTeacher,actionData:o};this.reDebug?this.receiveMessage(i):this.content.postMessage(JSON.stringify(i))},e.prototype.playAnimation=function(t,e,o,n,i){return t.timeScale=n,t.setToSetupPose(),t.clearTracks(),i&&t.setCompleteListener(function(){t.setCompleteListener(null),i()}),t.setAnimation(0,e,o)},e.prototype.playAniArray=function(t,e,o,n){var i=this,r=o.length;e<r-1?this.playAnimation(t,o[e],!1,1,function(){e++,i.playAniArray(t,e,o,n)}):(this.playAnimation(t,o[e],!0,1,null),n&&n())},e.prototype.getArrByNode=function(t,e){for(var o=t.children,n=[],i=0,r=o.length;i<r;i++){var a=o[i];a.name.indexOf(e)<0||n.push(a)}var s=e.length;return n.sort(function(t,e){return Number(t.name.slice(s,t.name.length))-Number(e.name.slice(s,e.name.length))}),[].concat(n)},e.prototype.getLocalPos=function(t,e){var o=t.parent.convertToWorldSpaceAR(t.position);return e.convertToNodeSpaceAR(o)},e.prototype.setParams=function(t){cc.log("set params: "+JSON.stringify(t)),this.pageNum=0,this.isTeacher=t.isTeacher||!1},e.prototype.setContent=function(t){this.content=t},e.prototype.receiveMessage=function(t){var e=t.actionData;if(cc.log(JSON.stringify(e)+","),e&&e.cmd&&e.info){var o=e.info;switch(e.cmd){case this.event_game_next:this.msgResultNext(o);break;case this.event_game_touch:this.msgResultTouch(o)}}},r([p([cc.AudioClip])],e.prototype,"arrAudio",void 0),r([p([cc.Node])],e.prototype,"arrQues",void 0),r([p([cc.Node])],e.prototype,"arrAnswer",void 0),r([p(cc.Node)],e.prototype,"btnNext",void 0),r([p(cc.Node)],e.prototype,"itemRole",void 0),r([c],e)}(cc.Component);o.default=l,cc._RF.pop()},{"./ItemSnailPaShanReprint":"ItemSnailPaShanReprint"}],ItemSnailPaShanReprint:[function(t,e,o){"use strict";cc._RF.push(e,"ee684pcO7tF1KVTnM0/jiMH","ItemSnailPaShanReprint");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,o,a):i(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.arrLabel=[],e}return i(e,t),e.prototype.updateUIForLabel=function(t,e){for(var o=0,n=this.arrLabel.length;o<n;o++){var i=this.arrLabel[o],r=t[o];i.active=e.indexOf(r)>=0}},r([c([cc.Node])],e.prototype,"arrLabel",void 0),r([s],e)}(cc.Component);o.default=p,cc._RF.pop()},{}]},{},["GameSnailPaShanReprint","ItemSnailPaShanReprint"]);