window.__require=function t(e,i,n){function o(s,r){if(!i[s]){if(!e[s]){var c=s.split("/");if(c=c[c.length-1],!e[c]){var p="function"==typeof __require&&__require;if(!r&&p)return p(c,!0);if(a)return a(c,!0);throw new Error("Cannot find module '"+s+"'")}s=c}var l=i[s]={exports:{}};e[s][0].call(l.exports,function(t){return o(e[s][1][t]||t)},l,l.exports,t,e,i,n)}return i[s].exports}for(var a="function"==typeof __require&&__require,s=0;s<n.length;s++)o(n[s]);return o}({GameSnailPaShan:[function(t,e,i){"use strict";cc._RF.push(e,"66f677K8exFG4MNlwyueJsw","GameSnailPaShan");var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),a=this&&this.__decorate||function(t,e,i,n){var o,a=arguments.length,s=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var r=t.length-1;r>=0;r--)(o=t[r])&&(s=(a<3?o(s):a>3?o(e,i,s):o(e,i))||s);return a>3&&s&&Object.defineProperty(e,i,s),s};Object.defineProperty(i,"__esModule",{value:!0});var s=t("./ItemSnailPaShanQ"),r=t("../res/hand/script/HandCtrSnail"),c=cc._decorator,p=c.ccclass,l=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.arrAudio=[],e.arrQues=[],e.arrAnswer=[],e.btnNext=null,e.skeletonRole=null,e.isLock=!1,e.isFinish=!1,e.quesIndex=0,e.selectItems=[],e.pageNum=0,e.arrNodeForRolePos=[],e.event_game_next="EVENT_GAME_NEXT",e.event_game_touch="EVENT_GAME_TOUDH",e.event_game_end="EVENT_GAME_END",e.reDebug=!1,e.isTeacher=!!e.reDebug,e.tiptimeCount=0,e.tipTimeMax=10,e.tipState=0,e.dataQues={options:[{answers:[3,0],soundId:0},{answers:[1],soundId:0},{answers:[5],soundId:0},{answers:[2,4],soundId:0}],dataSpine:["idle","chi","zou","kaixin"]},e}return o(e,t),e.prototype.onDisable=function(){kit.AudioPlayer.stopAll()},e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.sendMessage(this.event_game_end,{})},e.prototype.start=function(){this.setIsLock(!0),this.initData(),this.resetData(),this.updateUI(),this.nextQuestion()},e.prototype.update=function(t){this.isFinish||0===this.tipState&&(this.tiptimeCount+=t,this.tiptimeCount>=this.tipTimeMax&&(this.tiptimeCount=0,this.tipState=1,this.tipShow()))},e.prototype.initData=function(){var t=this.skeletonRole.node.parent;this.arrNodeForRolePos=this.getArrByNode(t,"pos")},e.prototype.resetData=function(){var t=this.content&&this.content.getSnapshot?this.content.getSnapshot():{};if(t&&(t=t.actionData),t&&t.cmd&&t.cmd!=this.event_game_end&&t.info&&t.page==this.pageNum){var e=t.info;this.refreshDataForMsg(e),t.cmd===this.event_game_touch&&e.result&&this.updateDataForMsg(e),window.sessionStorage.removeItem("workInfoList")}},e.prototype.updateUI=function(){this.updateUIForRole(),this.updateUIForQues(),this.updateUIForAnswer(),this.updateUIForBtn()},e.prototype.updateUIForRole=function(){var t=this.skeletonRole.node,e=this.selectItems.length,i=this.arrNodeForRolePos[e];t.position=i.position,t.angle=i.angle;var n=this.dataQues.dataSpine;this.playAnimation(this.skeletonRole,n[0],!0,1,null)},e.prototype.updateUIForQues=function(){for(var t=0,e=this.arrQues.length;t<e;t++)this.arrQues[t].active=this.selectItems.indexOf(t)<0},e.prototype.updateUIForAnswer=function(){for(var t=0,e=this.arrAnswer.length;t<e;t++){var i=this.arrAnswer[t];if(i.active=t===this.quesIndex,i.active){var n=this.dataQues.options[t];i.getComponent(s.default).updateUIForLabel(n.answers,this.selectItems)}}},e.prototype.updateUIForBtn=function(){var t=this;if(this.btnNext.active=!1,this.quesIndex<this.dataQues.options.length-1){var e=this.dataQues.options[this.quesIndex].answers.every(function(e){return t.selectItems.includes(e)});this.btnNext.active=!!e&&this.isTeacher}},e.prototype.tipStart=function(){this.tipState=0,this.tiptimeCount=0},e.prototype.tipShow=function(){var t=this;this.tipState=1;for(var e=function(e){var n=i.arrQues[e];if(n.active){var o=n.getChildByName("hand");o.active=!0;var a=o.getComponent(r.default),s=0,c=function(){s<3?(s++,a.Click(c)):(t.tipHide(),t.tipStart())};c()}},i=this,n=0,o=this.arrQues.length;n<o;n++)e(n)},e.prototype.tipHide=function(){this.tipState=1;for(var t=function(t){var i=e.arrQues[t],n=i.getChildByName("hand");i.active&&n.active&&(n.active=!0,n.opacity=255,cc.tween(n).to(.3,{opacity:0}).call(function(){n.opacity=255,n.active=!1}).start())},e=this,i=0,n=this.arrQues.length;i<n;i++)t(i)},e.prototype.nextQuestion=function(){var t=this;if(!this.isFinish)if(this.tipHide(),this.selectItems.length>0)this.setIsLock(!1),this.tipStart();else{for(var e=0,i=this.arrQues.length;e<i;e++){var n=this.arrQues[e];if(n.active){var o=n.getChildByName("label");o.opacity=0,cc.tween(o).delay(.5).to(.5,{opacity:255}).start()}}var a=this.arrAnswer[this.quesIndex].getComponent(s.default).arrLabel[0].parent;a.opacity=0,cc.tween(a).delay(.5).to(.5,{opacity:255}).start(),this.scheduleOnce(function(){t.setIsLock(!1),t.tipShow()},1)}},e.prototype.eventNext=function(){this.btnNext.active=!1,this.quesIndex++,this.sendMessage(this.event_game_next,{})},e.prototype.msgResultNext=function(t){var e=this;this.setIsLock(!0),this.refreshDataForMsg(t);var i=this.arrAnswer[this.quesIndex-1],n=i.getComponent(s.default).arrLabel[0].parent;n.opacity=255,cc.tween(n).to(.4,{opacity:0}).call(function(){i.active=!1}).start();var o=this.arrAnswer[this.quesIndex],a=o.getComponent(s.default).arrLabel[0].parent;o.active=!0,a.opacity=0,cc.tween(a).delay(.4).to(.4,{opacity:255}).call(function(){e.updateUIForBtn(),e.nextQuestion()}).start()},e.prototype.eventTouch=function(t){if(!this.isLock){var e=this.arrQues.indexOf(t.target.parent);if(!(e<0||this.selectItems.indexOf(e)>=0)){var i=!0,n=this.dataQues.options[this.quesIndex],o=n.answers.indexOf(e);if(o>0){var a=n.answers[o-1];this.selectItems.indexOf(a)<0&&(i=!1)}else o<0&&(i=!1);this.setIsLock(!0),this.sendMessage(this.event_game_touch,{itemId:e,result:i})}}},e.prototype.msgResultTouch=function(t){var e=this;this.setIsLock(!0);var i=t.itemId,n=t.result;if(this.refreshDataForMsg(t),n){var o=function(){e.updateDataForMsg(t),e.isFinish?e.playAniWin():(e.updateUI(),e.dataQues.options[e.quesIndex].answers.every(function(t){return e.selectItems.includes(t)})||e.nextQuestion())};this.playAniSuccess(i,o.bind(this))}else o=function(){e.setIsLock(!1),e.tipStart()},this.playAniWrong(i,o.bind(this))},e.prototype.playAniSuccess=function(t,e){var i=this,n=this.dataQues.dataSpine,o=this.arrQues[t],a=this.skeletonRole.node,r=function(){kit.AudioPlayer.playEffect(i.arrAudio[2]);var t=a.parent.getChildByName("icon");t.active=!0;var e=a.position,s=o.getChildByName("icon");s.active=!1,t.position=i.getLocalPos(s,t.parent),t.scale=1.2*s.scale,t.angle=s.angle;var r={position:t.position,scale:t.scale,angle:t.angle},c=cc.v2(r.position.x,r.position.y),p=cc.v2(e.x,e.y+50),l=cc.v2((c.x+p.x)/2,c.y+700),u=cc.tween;u(t).parallel(u().bezierTo(1.5,c,l,p),u().to(.3,{scale:r.scale/1.2}),u().to(1.5,{angle:r.angle+1080})).call(function(){t.active=!1,i.playAnimation(i.skeletonRole,n[0],!0,1,null);var e=[n[1],n[0]];i.playAniArray(i.skeletonRole,0,e,null)}).start()},c=function(){kit.AudioPlayer.playEffect(i.arrAudio[0]);var t={y:o.y,opacity:o.opacity};cc.tween(o).to(.4,{y:t.y-200,opacity:0}).call(function(){o.y=t.y,o.opacity=t.opacity,o.active=!1}).start()},p=this.skeletonRole.findAnimation(n[2]).duration,l=function(){i.skeletonRole.setToSetupPose(),i.skeletonRole.clearTracks();var t=i.skeletonRole.setAnimation(0,n[2],!1);i.skeletonRole.addAnimation(0,n[0],!0),i.skeletonRole.setTrackEventListener(t,function(t,e){if("1"!==e.data.name);else{kit.AudioPlayer.playEffect(i.arrAudio[3]);var n=i.arrNodeForRolePos[i.selectItems.length+1],o=cc.tween;o(a).parallel(o().to(1.634,{position:n.position}),o().to(1.634,{angle:n.angle})).start()}})};cc.tween(this.node).call(function(){r()}).delay(1.5).call(function(){c()}).delay(.2).call(function(){var e,n;e=i.dataQues.options[i.quesIndex].answers.indexOf(t),(n=i.arrAnswer[i.quesIndex].getComponent(s.default).arrLabel[e]).active=!0,n.opacity=0,cc.tween(n).to(.4,{opacity:255}).start()}).delay(.4).call(function(){l()}).delay(p).call(function(){e()}).start()},e.prototype.playAniWrong=function(t,e){kit.AudioPlayer.playEffect(this.arrAudio[1]);var i=this.arrQues[t];cc.tween(i).to(.2,{angle:-10}).to(.2,{angle:10}).to(.2,{angle:-10}).to(.2,{angle:0}).call(function(){e()}).start()},e.prototype.playAniWin=function(){kit.AudioPlayer.playEffect(this.arrAudio[4]);var t=this.dataQues.dataSpine,e=[t[3],t[0]],i=this.skeletonRole.node,n=i.angle;i.angle=0,this.playAniArray(this.skeletonRole,0,e,function(){i.angle=n})},e.prototype.setIsLock=function(t){this.isLock=t,this.isLock&&this.tipHide()},e.prototype.refreshDataForMsg=function(t){this.quesIndex=t.quesIndex,this.selectItems=t.selectItems},e.prototype.updateDataForMsg=function(t){this.selectItems.push(t.itemId),this.selectItems.length>this.arrQues.length-1&&(this.isFinish=!0)},e.prototype.sendMessage=function(t,e){var i={cmd:t,page:this.pageNum,info:{itemId:0,result:!1,quesIndex:this.quesIndex,selectItems:this.selectItems}};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(i.info[n]=e[n]);var o={isTeacher:this.isTeacher,actionData:i};this.reDebug?this.receiveMessage(o):this.content.postMessage(JSON.stringify(o))},e.prototype.playAnimation=function(t,e,i,n,o){return t.timeScale=n,t.setToSetupPose(),t.clearTracks(),o&&t.setCompleteListener(function(){t.setCompleteListener(null),o()}),t.setAnimation(0,e,i)},e.prototype.playAniArray=function(t,e,i,n){var o=this,a=i.length;e<a-1?this.playAnimation(t,i[e],!1,1,function(){e++,o.playAniArray(t,e,i,n)}):(this.playAnimation(t,i[e],!0,1,null),n&&n())},e.prototype.getArrByNode=function(t,e){for(var i=t.children,n=[],o=0,a=i.length;o<a;o++){var s=i[o];s.name.indexOf(e)<0||n.push(s)}var r=e.length;return n.sort(function(t,e){return Number(t.name.slice(r,t.name.length))-Number(e.name.slice(r,e.name.length))}),[].concat(n)},e.prototype.getLocalPos=function(t,e){var i=t.parent.convertToWorldSpaceAR(t.position);return e.convertToNodeSpaceAR(i)},e.prototype.setParams=function(t){cc.log("set params: "+JSON.stringify(t)),this.pageNum=0,this.isTeacher=t.isTeacher||!1},e.prototype.setContent=function(t){this.content=t},e.prototype.receiveMessage=function(t){var e=t.actionData;if(cc.log(JSON.stringify(e)+","),e&&e.cmd&&e.info){var i=e.info;switch(e.cmd){case this.event_game_next:this.msgResultNext(i);break;case this.event_game_touch:this.msgResultTouch(i)}}},a([l([cc.AudioClip])],e.prototype,"arrAudio",void 0),a([l([cc.Node])],e.prototype,"arrQues",void 0),a([l([cc.Node])],e.prototype,"arrAnswer",void 0),a([l(cc.Node)],e.prototype,"btnNext",void 0),a([l(sp.Skeleton)],e.prototype,"skeletonRole",void 0),a([p],e)}(cc.Component);i.default=u,cc._RF.pop()},{"../res/hand/script/HandCtrSnail":"HandCtrSnail","./ItemSnailPaShanQ":"ItemSnailPaShanQ"}],HandCtrSnail:[function(t,e,i){"use strict";cc._RF.push(e,"5cffcKCFBhFhqL40gEcET53","HandCtrSnail");var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),a=this&&this.__decorate||function(t,e,i,n){var o,a=arguments.length,s=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var r=t.length-1;r>=0;r--)(o=t[r])&&(s=(a<3?o(s):a>3?o(e,i,s):o(e,i))||s);return a>3&&s&&Object.defineProperty(e,i,s),s};Object.defineProperty(i,"__esModule",{value:!0});var s,r,c=cc._decorator,p=c.ccclass,l=c.property;(function(t){t.danji="dainji",t.dianji="dainjitaiqi",t.taishou="taiqi"})(s||(s={})),function(t){t.dianji="dianji",t.taishou="taishou"}(r||(r={}));var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.skAperture=null,e.skHand=null,e.arrow=null,e.arrowWidth=0,e}return o(e,t),e.prototype.start=function(){},e.prototype.onEnable=function(){this.skAperture.node.active=!1},e.prototype.onDisable=function(){this.arrow.stopAllActions(),this.arrow.width=0,this.node.stopAllActions(),this.unscheduleAllCallbacks()},e.prototype.Press=function(t){var e=this;this.skAperture.node.active=!1,this.playSpine(this.skHand,s.danji,!1,function(){e.skAperture.node.active=!0,e.playSpine(e.skAperture,r.dianji,!1,function(){t&&t()})})},e.prototype.Lift=function(t){this.playSpine(this.skHand,s.taishou,!1,function(){t&&t()})},e.prototype.Click=function(t){var e=this;void 0===t&&(t=null),this.skAperture.node.active=!0,this.playSpine(this.skAperture,r.dianji,!1),this.playSpine(this.skHand,s.danji,!1,function(){e.playSpine(e.skHand,s.taishou,!1,function(){t&&t()})})},e.prototype.ClickCycle=function(){var t=this;this.node.active=!0,this.schedule(function(){t.Click()},2,cc.macro.REPEAT_FOREVER,.01)},e.prototype.ClickCycleByScale=function(t,e){var i=this;this.node.active=!0,this.schedule(function(){i.Click()},e,cc.macro.REPEAT_FOREVER,.01),this.skHand.timeScale=t,this.skAperture.timeScale=t},e.prototype.TouchAnimation=function(t,e,i){var n=this;void 0===i&&(i=.5),this.node.active=!0,this.node.stopAllActions(),this.node.setPosition(t),this.arrow.width=0,this.Press(function(){cc.tween(n.node).to(i,{position:cc.v3(e.x,e.y,0)}).call(function(){n.Lift(null)}).start(),cc.tween(n.arrow).to(i,{width:n.arrowWidth}).call(function(){}).start()})},e.prototype.MoveWithPosList=function(t,e){var i=this;this.node.active=!0,this.node.stopAllActions(),this.node.setPosition(t),this.arrow.width=0;for(var n=[],o=function(t){n.push(function(){return new Promise(function(e){cc.tween(i.node).to(t.time,{position:cc.v3(t.pos.x,t.pos.y,0)}).call(function(){e(null)}).start()})})},a=0,s=e;a<s.length;a++)o(s[a]);return new Promise(function(t){i.Press(function(){var e,o;(e=n,o=Promise.resolve(),e.forEach(function(t){o=o.then(t)}),o).then(function(){i.Lift(null),t()})})})},e.prototype.TouchCycle=function(t,e,i,n){var o=this;void 0===i&&(i=3),void 0===n&&(n=.5),this.node.setPosition(t),this.schedule(function(){o.TouchAnimation(t,e,n)},i,cc.macro.REPEAT_FOREVER,.01);var a=Math.abs(e.x-t.x),s=Math.abs(e.y-t.y),r=e.sub(t).signAngle(cc.v2(1,0))/Math.PI*180;this.arrow.active=!0,this.arrow.angle=-r,this.arrowWidth=Math.sqrt(a*a+s*s)/this.node.scale,this.arrow.getChildByName("arrow").width<this.arrowWidth&&(this.arrow.getChildByName("arrow").width=this.arrowWidth)},e.prototype.stopCycleAllAction=function(){this.unscheduleAllCallbacks(),cc.Tween.stopAllByTarget(this.node),cc.Tween.stopAllByTarget(this.arrow)},e.prototype.wipeCycle=function(t,e,i){var n=this;void 0===i&&(i=200),this.node.active=!0,this.node.setPosition(t),this.arrow.active=!1;var o=e.sub(t).mag();this.playSpine(this.skHand,s.danji,!1,function(){n.skAperture.node.active=!0,n.playSpine(n.skAperture,r.dianji,!0),cc.tween(n.node).repeatForever(cc.tween().to(o/i,{position:cc.v3(e)}).to(o/i,{position:cc.v3(t)})).start()})},e.prototype.playSpine=function(t,e,i,n){void 0===i&&(i=!1),void 0===n&&(n=null),t.clearTracks(),t.setToSetupPose(),t.setAnimation(0,e,i)&&!i&&t.setCompleteListener(function(t){(t.animation.name?t.animation.name:"")==e&&n&&n()})},a([l({type:sp.Skeleton,displayName:"\u5149\u5708"})],e.prototype,"skAperture",void 0),a([l({type:sp.Skeleton,displayName:"\u624b\u6307"})],e.prototype,"skHand",void 0),a([l({type:cc.Node,displayName:"\u7bad\u5934"})],e.prototype,"arrow",void 0),a([p],e)}(cc.Component);i.default=u,cc._RF.pop()},{}],ItemSnailPaShanQ:[function(t,e,i){"use strict";cc._RF.push(e,"2dd54xv0WdJ/6J8QX7PnGjY","ItemSnailPaShanQ");var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),a=this&&this.__decorate||function(t,e,i,n){var o,a=arguments.length,s=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var r=t.length-1;r>=0;r--)(o=t[r])&&(s=(a<3?o(s):a>3?o(e,i,s):o(e,i))||s);return a>3&&s&&Object.defineProperty(e,i,s),s};Object.defineProperty(i,"__esModule",{value:!0});var s=cc._decorator,r=s.ccclass,c=s.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.arrLabel=[],e}return o(e,t),e.prototype.updateUIForLabel=function(t,e){for(var i=0,n=this.arrLabel.length;i<n;i++){var o=this.arrLabel[i],a=t[i];o.active=e.indexOf(a)>=0}},a([c([cc.Node])],e.prototype,"arrLabel",void 0),a([r],e)}(cc.Component);i.default=p,cc._RF.pop()},{}]},{},["HandCtrSnail","GameSnailPaShan","ItemSnailPaShanQ"]);